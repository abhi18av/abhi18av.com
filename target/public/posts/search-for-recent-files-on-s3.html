<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"><link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/manifest.json" rel="manifest"><link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon"><meta content="#ffffff" name="theme-color"><link href="/css/normalize.css" rel="stylesheet"><link href="/css/app.css" rel="stylesheet"><title>Search for recently updated files on Amazon S3 - 200ok</title><link href="/rss.xml" rel="alternate" title="200ok - Consultancy, Research Lab, Incubator" type="application/rss+xml"><link href="/atom.xml" rel="alternate" title="200ok - Consultancy, Research Lab, Incubator" type="application/atom+xml"><meta content="Search for recently updated files on Amazon S3 - 200ok" property="og:title"><meta content="article" property="og:type"><meta property="og:description"><meta content="https://200ok.ch/posts/search-for-recent-files-on-s3.html" property="og:url"><meta content="https://200ok.ch/img/logo.png" property="og:image"><meta content="summary" name="twitter:card"><meta content="@twohundredok" name="twitter:site"><meta content="Search for recently updated files on Amazon S3 - 200ok" name="twitter:title"><meta content="https://200ok.ch/img/logo.png" name="twitter:image"><meta name="twitter:description"><link href="https://200ok.ch/posts/search-for-recent-files-on-s3.html" rel="canonical"><link href="/css/styles/solarized-light.css" rel="stylesheet"></head><body id="blog" itemscope itemtype="http://schema.org/Blog"><div class="top-bar"><div class="top-bar-left"><top-bar-title itemprop="image"><a href="/" id="logo"><img src="/img/200ok.svg"></a></top-bar-title></div><div class="top-bar-right"><ul class="menu"><li><a href="/blog.html">Blog</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/team.html">Team</a></li><li><a href="/atom.xml" id="atom-feed"><span>&nbsp;</span>Feed</a></li></ul></div></div><main class="single-post"><div id="content"><article class="blog-post" itemscope itemtype="https://schema.org/BlogPosting"><h3 class="headline" itemprop="headline"><a class="nunito" href="/posts/search-for-recent-files-on-s3.html" itemprop="url">Search for recently updated files on Amazon S3</a></h3><div class="subheader"><p class="post-meta"><time itemprop="datePublished">2017-04-11</time> - <span itemprop="wordCount">360</span> words - <span itemprop="timeRequired">2</span> min read</p><div class="byline"><img class="author-icon" src="/img/author.svg"><section class="author" itemprop="author" itemscope itemtype="https://schema.org/Person"><span itemprop="name">Alain M. Lafon</span></section></div></div><span itemprop="image" itemscope itemtype="https://schema.org/ImageObject"><meta content="190" itemprop="height"><meta content="349" itemprop="width"><meta content="https://200ok.ch/img/logo.png" itemprop="url"></span><div><div class="article-body" itemprop="articleBody"><p>Amazon AWS has a nice <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html">command line client</a> for their public cloud. This client is very well suited for automating tasks in many IaaS DevOps scenarios. However, it can also be used by a person. The scenarios to do so might be different than for automation, though.</p>
<p>A common scenario for looking into S3 is to want to list files ordered by date and including metadata. On a Unix machine, this would be an <code>ls -lt</code>. If it’s a very long list of files, you might want to cap the list - which again is very easy to achieve, for example with <code>ls -lt | head -n 10</code>.</p>
<p>Those two things are easy on a Unix machine, but not so straight forward on Amazon S3. Amazon does have an <code>ls</code> command which will list all files within <code>[BUCKET]</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">aws</span> s3 ls s3://[BUCKET]</a></code></pre></div>
<p>It is totally feasible to pipe the result of this command into <code>head -n X</code>. It does have serious drawbacks, though, because you might have <em>a lot</em> of files on S3:</p>
<ol type="1">
<li>You will first request all files over the network which will take a while and then remove most of them. Waiting for lots of irrelevant data to come over the wire is not efficient use of your time.</li>
<li>To list things actually does come with a <a href="https://aws.amazon.com/s3/pricing/">price tag</a> on S3! Meaning that if you have lots of data on S3 and you’re doing this a lot, then you will pay for data that you never use, but discard. This might not be a lot of money depending on how many requests you have to do, but still.</li>
</ol>
<p>Next to <code>aws s3</code>, which only implements the most high level features such as <code>cp</code> and <code>mv</code>, there is a more powerful API <a href="http://docs.aws.amazon.com/cli/latest/reference/s3api/index.html#cli-aws-s3api"><code>aws s3api</code></a>. With this API you can write queries <em>and</em> limit the amount of objects returned. Queries can include the <code>LastModified</code> timestamp. Limiting on this timestamp is not the same as ordering by time (as in <code>ls -lt</code>), but it’s the closest you will get to this functionality on S3.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">aws</span> s3api list-objects \</a>
<a class="sourceLine" id="cb2-2" title="2">--bucket <span class="st">&quot;[BUCKET]&quot;</span> \</a>
<a class="sourceLine" id="cb2-3" title="3">--query <span class="st">&#39;Contents[?LastModified&gt;=`2017-04-10`][].{Key: Key, Size:</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">Size, LastModified: LastModified}&#39;</span></a></code></pre></div>
</div><div class="tags"><img class="tag-icon" src="/img/tag.svg"><ul itemprop="keywords"><li class="category"><a href="/category/tooling.html">tooling</a></li><li class="tag"><a href="/tags/aws.html">#aws</a></li><li class="tag"><a href="/tags/cloud.html">#cloud</a></li><li class="tag"><a href="/tags/s3.html">#s3</a></li></ul></div></div></article></div></main><footer><div itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><div class="name" itemprop="name">200ok GmbH</div><div itemprop="address" itemscope itemtype="https://schema.org/PostalAddress"><a href="https://goo.gl/maps/GNAoiNF7mbL2" title="View on Google Maps"><div itemprop="streetAddress">Badenerstrasse 313</div><div><span itemprop="postalCode">8003</span> <span itemprop="addressLocality">Zürich</span></div></a></div><div itemprop="telephone">+41 76 405 05 67</div><div itemprop="email"><a href="mailto:info@200ok.ch">info@200ok.ch</a></div><img itemprop="logo" src="https://200ok.ch/img/200ok.svg"></div></footer><div class="scripts" style="{:display &quot;none&quot;}"><script src="/js/vendor/bowser.min.js"></script><script async src="/js/ie_safeguard.js"></script><script async src="/js/tour.js"></script><script src="/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>tour=null</script></div></body></html>