<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"><link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/manifest.json" rel="manifest"><link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon"><meta content="#ffffff" name="theme-color"><link href="/css/normalize.css" rel="stylesheet"><link href="/css/app.css" rel="stylesheet"><title>Write your own brightness control - 200ok</title><link href="/rss.xml" rel="alternate" title="200ok - Consultancy, Research Lab, Incubator" type="application/rss+xml"><link href="/atom.xml" rel="alternate" title="200ok - Consultancy, Research Lab, Incubator" type="application/atom+xml"><meta content="Write your own brightness control - 200ok" property="og:title"><meta content="article" property="og:type"><meta property="og:description"><meta content="https://200ok.ch/posts/2018-03-08_Write_your_own_brightness_control.html" property="og:url"><meta content="https://200ok.ch/img/logo.png" property="og:image"><meta content="summary" name="twitter:card"><meta content="@twohundredok" name="twitter:site"><meta content="Write your own brightness control - 200ok" name="twitter:title"><meta content="https://200ok.ch/img/logo.png" name="twitter:image"><meta name="twitter:description"><link href="https://200ok.ch/posts/2018-03-08_Write_your_own_brightness_control.html" rel="canonical"><link href="/css/styles/solarized-light.css" rel="stylesheet"></head><body id="blog" itemscope itemtype="http://schema.org/Blog"><div class="top-bar"><div class="top-bar-left"><top-bar-title itemprop="image"><a href="/" id="logo"><img src="/img/200ok.svg"></a></top-bar-title></div><div class="top-bar-right"><ul class="menu"><li><a href="/blog.html">Blog</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/team.html">Team</a></li><li><a href="/atom.xml" id="atom-feed"><span>&nbsp;</span>Feed</a></li></ul></div></div><main class="single-post"><div id="content"><article class="blog-post" itemscope itemtype="https://schema.org/BlogPosting"><h3 class="headline" itemprop="headline"><a class="nunito" href="/posts/2018-03-08_Write_your_own_brightness_control.html" itemprop="url">Write your own brightness control</a></h3><div class="subheader"><p class="post-meta"><time itemprop="datePublished">2018-03-08</time> - <span itemprop="wordCount">639</span> words - <span itemprop="timeRequired">5</span> min read</p><div class="byline"><img class="author-icon" src="/img/author.svg"><section class="author" itemprop="author" itemscope itemtype="https://schema.org/Person"><span itemprop="name">Alain M. Lafon</span></section></div></div><span itemprop="image" itemscope itemtype="https://schema.org/ImageObject"><meta content="190" itemprop="height"><meta content="349" itemprop="width"><meta content="https://200ok.ch/img/logo.png" itemprop="url"></span><div><div class="article-body" itemprop="articleBody"><p>Generally speaking, Linux tooling support is pretty great these days. Iâ€™m running Debian Stable on a Macbook Pro (MBP) and couldnâ€™t be happier. Most things just work as expected.</p>
<p>Apart from a few tiny things here and there. One of them is the ability to adjust brightness. The standard way for many window managers (WM) is to defer that functionality to <code>xbacklight</code>. However, this doesnâ€™t work on the MBP.</p>
<pre><code>munen@debzen:~% xbacklight
No outputs have backlight property</code></pre>
<p><code>xbacklight</code> looks for some settings in <code>/sys/class/backlight</code>, but itâ€™s not configurable under which sub-directory it looks. And for some reason, the drivers for the MBP puts the settings in different directory.</p>
<p>While it would be proper to fix this upstream, I decided on working on this while on the train and being offline - so I took a quicker route and re-implemented the basic functionality in Ruby. To be able to get this done in a couple of minutes is a testament to the transparency and ease of use of a Linux system.</p>
<h2 id="steps-to-build-your-own-brightness-control">Steps to build your own brightness control</h2>
<h3 id="agenda">Agenda</h3>
<ol type="1">
<li>Write a script to adjust brightness control</li>
<li>Bind the script to your regular brightness keys on the keyboard</li>
<li>Have some visual feedback on brightness</li>
</ol>
<h3 id="write-a-script">1. Write a script</h3>
<p>Requirements:</p>
<ul>
<li>It should know about the upper bound of your hardware
<ul>
<li>Otherwise you could damage your hardware</li>
</ul></li>
<li>It should accept parameters from the command line
<ul>
<li>Then it can be called from a WM shortcut</li>
</ul></li>
</ul>
<p><code>/usr/local/bin/brightness</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">#!/usr/bin/env ruby</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co"># coding: utf-8</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co"># Get maximum and current brightness from `/sys` which is provided by</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co"># the kernel</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="ot">@max_brightness</span> = <span class="st">`cat /sys/class/backlight/gmux_backlight/max_brightness`</span>.to_i</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="ot">@brightness</span> = <span class="st">`cat /sys/class/backlight/gmux_backlight/brightness`</span>.to_i</a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="kw">def</span> brighter</a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="ot">@brightness</span> = (<span class="ot">@brightness</span> * <span class="fl">1.1</span>).to_i</a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12">  <span class="co"># Failsafe</span></a>
<a class="sourceLine" id="cb2-13" title="13">  <span class="ot">@brightness</span> = <span class="ot">@max_brightness</span> <span class="kw">if</span>(<span class="ot">@brightness</span> &gt; <span class="ot">@max_brightness</span>)</a>
<a class="sourceLine" id="cb2-14" title="14"></a>
<a class="sourceLine" id="cb2-15" title="15">  <span class="co"># Start with a little light</span></a>
<a class="sourceLine" id="cb2-16" title="16">  <span class="ot">@brightness</span> = <span class="dv">50</span> <span class="kw">if</span> (<span class="ot">@brightness</span> &lt; <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb2-17" title="17"><span class="kw">end</span></a>
<a class="sourceLine" id="cb2-18" title="18"></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="kw">def</span> darker</a>
<a class="sourceLine" id="cb2-20" title="20">  <span class="ot">@brightness</span> = (<span class="ot">@brightness</span> * <span class="fl">0.9</span>).to_i</a>
<a class="sourceLine" id="cb2-21" title="21">  <span class="ot">@brightness</span> = <span class="dv">0</span> <span class="kw">if</span> (<span class="ot">@brightness</span> &lt; <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb2-22" title="22"><span class="kw">end</span></a>
<a class="sourceLine" id="cb2-23" title="23"></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co"># Note: This needs passwordless sudo privileges</span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="kw">def</span> set_brightness</a>
<a class="sourceLine" id="cb2-26" title="26">  <span class="st">`echo </span><span class="ot">#{@brightness}</span><span class="st"> | sudo tee /sys/class/backlight/gmux_backlight/brightness`</span></a>
<a class="sourceLine" id="cb2-27" title="27">  puts <span class="ot">@brightness</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="kw">end</span></a>
<a class="sourceLine" id="cb2-29" title="29"></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="kw">def</span> get_status</a>
<a class="sourceLine" id="cb2-31" title="31">  puts <span class="st">&quot;ðŸ’¡ </span><span class="ot">#{</span>(<span class="dv">100</span> * <span class="ot">@brightness</span> / <span class="fl">1023.0</span>).to_i<span class="ot">}</span><span class="st">%&quot;</span></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="kw">end</span></a>
<a class="sourceLine" id="cb2-33" title="33"></a>
<a class="sourceLine" id="cb2-34" title="34"><span class="kw">case</span> <span class="dt">ARGV</span>[<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb2-35" title="35"><span class="kw">when</span> <span class="st">&quot;darker&quot;</span></a>
<a class="sourceLine" id="cb2-36" title="36">  darker</a>
<a class="sourceLine" id="cb2-37" title="37">  set_brightness</a>
<a class="sourceLine" id="cb2-38" title="38"><span class="kw">when</span> <span class="st">&quot;brighter&quot;</span></a>
<a class="sourceLine" id="cb2-39" title="39">  brighter</a>
<a class="sourceLine" id="cb2-40" title="40">  set_brightness</a>
<a class="sourceLine" id="cb2-41" title="41"><span class="kw">when</span> <span class="st">&quot;status&quot;</span></a>
<a class="sourceLine" id="cb2-42" title="42">  get_status</a>
<a class="sourceLine" id="cb2-43" title="43"><span class="kw">end</span></a></code></pre></div>
<p>If <code>xbacklight</code> doesnâ€™t work for you and the above script doesnâ€™t work as well, then your driver might just use yet another folder to expose the brightness controls. Check out if thereâ€™s any folder in <code>/sys/class/backlight</code> - if so, thatâ€™s probably the one and you can change the above script accordingly.</p>
<p>This script should reside in <code>/usr/local/bin</code> and have executable permission.</p>
<p>The parameters are:</p>
<ul>
<li><code>brighter</code>: Increases brightness by 10%</li>
<li><code>darker</code>: Decreases brightness by 10%</li>
<li><code>status</code>: Prints the brightness status in percent</li>
</ul>
<h3 id="bind-the-script-to-shortcuts">2. Bind the script to shortcuts</h3>
<p>First, find the keycodes to your brightness keys on the keyboard. Start the <code>xev</code> command in a terminal, hit the brightness keys and look for the keycodes in the verbose output.</p>
<p>Secondly, register the <code>brightness</code> script as a shortcut. For example, this is the configuration for the i3 window manager:</p>
<p><code>~/.i3/config</code>:</p>
<pre><code>bindcode 232 exec &quot;brightness darker&quot;
bindcode 233 exec &quot;brightness brighter&quot;</code></pre>
<p>Restart your window manager - or reload it with your config file. For i3, the latter is bound to <code>Mod+Shift+R</code>. Then test the key bindings.</p>
<h3 id="visual-feedback">3. Visual feedback</h3>
<p>Many people use onscreen displays for this. There are many existing tools that you could employ. I want this information in the status bar - so I augmented the <code>i3status</code> status bar.</p>
<p>To include new information in <code>i3status</code>, you have to write a wrapper script around <code>i3status</code>:</p>
<p><code>/usr/local/bin/my_i3status.sh</code>:</p>
<pre><code>#!/bin/sh
# shell script to prepend i3status with brightness info

i3status | while :
do
        read line
        echo &quot;`brightness status` | $line&quot; || exit 1
done</code></pre>
<p>To use it, change the <code>status_command</code> in <code>.i3/config</code>.</p>
<pre><code>bar {
        status_command my_i3status.sh
}</code></pre>
<p>Reload your i3 config once again and enjoy the happy light light bulb^^</p>
<p><img src="/img/2018-03/i3_status.png" /></p>
</div><div class="tags"><img class="tag-icon" src="/img/tag.svg"><ul itemprop="keywords"><li class="category"><a href="/category/debian.html">Debian</a></li><li class="tag"><a href="/tags/linux.html">#linux</a></li><li class="tag"><a href="/tags/tooling.html">#tooling</a></li></ul></div></div></article></div></main><footer><div itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><div class="name" itemprop="name">200ok GmbH</div><div itemprop="address" itemscope itemtype="https://schema.org/PostalAddress"><a href="https://goo.gl/maps/GNAoiNF7mbL2" title="View on Google Maps"><div itemprop="streetAddress">Badenerstrasse 313</div><div><span itemprop="postalCode">8003</span> <span itemprop="addressLocality">ZÃ¼rich</span></div></a></div><div itemprop="telephone">+41 76 405 05 67</div><div itemprop="email"><a href="mailto:info@200ok.ch">info@200ok.ch</a></div><img itemprop="logo" src="https://200ok.ch/img/200ok.svg"></div></footer><div class="scripts" style="{:display &quot;none&quot;}"><script src="/js/vendor/bowser.min.js"></script><script async src="/js/ie_safeguard.js"></script><script async src="/js/tour.js"></script><script src="/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>tour=null</script></div></body></html>